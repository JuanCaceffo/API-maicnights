version: "3.9"
services:
  mongo1:
    image: mongo:latest
    container_name: mongo1
    restart: always
    ports:
      - "27017:27017"
    networks:
      mn-net:
        ipv4_address: 172.16.238.10
    volumes:
      - mongo-data1:/data/db
      - mongo-cfg1:/data/configdb
      - mongo-log1:/var/log/mongodb
      - ./scripts/rs-init.sh:/scripts/rs-init.sh
      - ./scripts/init.js:/scripts/init.js
      - ./scripts/init.js:/docker-entrypoint-initdb.d/01-init-mongo.js:ro
    #environment:
    #  MONGO_INITDB_ROOT_USERNAME: admin
    #  MONGO_INITDB_ROOT_PASSWORD: admin
    #  MONGO_INITDB_DATABASE: magicnights
    depends_on:
      - mongo2
      - mongo3
      - mongo4
    links:
      - mongo2
      - mongo3
      - mongo4
    command: ["mongod", "--bind_ip_all", "--replSet", "mnrs"]

  mongo2:
    image: mongo:latest
    container_name: mongo2
    restart: always
    ports:
      - "27018:27017"
    networks:
      mn-net:
        ipv4_address: 172.16.238.11
    volumes:
      - mongo-data2:/data/db
      - mongo-cfg2:/data/configdb
      - mongo-log2:/var/log/mongodb
    command: ["mongod", "--bind_ip_all", "--replSet", "mnrs"]

  mongo3:
    image: mongo:latest
    container_name: mongo3
    restart: always
    ports:
      - "27019:27017"
    networks:
      mn-net:
        ipv4_address: 172.16.238.12
    volumes:
      - mongo-data3:/data/db
      - mongo-cfg3:/data/configdb
      - mongo-log3:/var/log/mongodb
    command: ["mongod", "--bind_ip_all", "--replSet", "mnrs"]

  mongo4:
    image: mongo:latest
    container_name: mongo4
    restart: always
    ports:
      - "27020:27017"
    networks:
      mn-net:
        ipv4_address: 172.16.238.13
    volumes:
      - mongo-data4:/data/db
      - mongo-cfg4:/data/configdb
      - mongo-log4:/var/log/mongodb
    command: [ "mongod", "--bind_ip_all", "--replSet", "mnrs" ]

volumes:
  mongo-data1:
    driver: local
  mongo-cfg1:
    driver: local
  mongo-log1:
    driver: local
  mongo-data2:
    driver: local
  mongo-cfg2:
    driver: local
  mongo-log2:
      driver: local
  mongo-data3:
    driver: local
  mongo-cfg3:
    driver: local
  mongo-log3:
    driver: local
  mongo-data4:
    driver: local
  mongo-cfg4:
    driver: local
  mongo-log4:
    driver: local

networks:
  mn-net:
    name: mn-net
    ipam:
      driver: default
      config:
        - subnet: 172.16.238.0/24